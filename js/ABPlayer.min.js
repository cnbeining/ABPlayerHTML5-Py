function isMobile(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}function CommentLoader(a,b,c){null==c&&(c=function(){});var d=null;d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d.open("GET",a,!0),d.send();var e=b;d.onreadystatechange=function(){if(4==d.readyState&&200==d.status)if("Microsoft Internet Explorer"==navigator.appName){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1,a.loadXML(d.responseText),e.load(BilibiliParser(a)),c()}else e.load(BilibiliParser(d.responseXML)),c()}}function createCORSRequest(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c}var ABP={version:"0.8.0"};!function(){"use strict";if(ABP){var a=jQuery,b=function(a){return document.getElementById(a)},c=function(a,b,c,d){var e=null;if("text"===a)return document.createTextNode(b);e=document.createElement(a);for(var f in b)if("style"!==f&&"className"!==f)e.setAttribute(f,b[f]);else if("className"===f)e.className=b[f];else for(var g in b.style)e.style[g]=b.style[g];if(c)for(var h=0;h<c.length;h++)null!=c[h]&&e.appendChild(c[h]);return d&&"function"==typeof d&&d(e),e},d=function(a,b){for(;a;a=a.parentNode)if(m(a.parentNode,b))return a};HTMLElement.prototype.tooltip=function(a){this.tooltipData=a,this.dispatchEvent(new Event("updatetooltip"))},"undefined"==typeof HTMLElement.prototype.requestFullScreen&&(HTMLElement.prototype.requestFullScreen=function(){this.webkitRequestFullscreen?this.webkitRequestFullscreen():this.mozRequestFullScreen?this.mozRequestFullScreen():this.msRequestFullscreen&&this.msRequestFullscreen()}),"undefined"==typeof document.isFullScreen&&(document.isFullScreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenEnabled}),"undefined"==typeof document.exitFullscreen&&(document.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():msExitFullscreen&&msExitFullscreen()});var e=function(a,b){b=b||2;for(var c=""+a;c.length<b;)c="0"+c;return c},f=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},g=function(a,b){for(var c="",d=1;d<=b-(a+"").length;d++)c+="0";return c+a},h=function(a,b){if(0==a)return lang.oneDay;var c,d,e,f,g,h,i=new Date(1e3*parseInt(a));return c=String(i.getFullYear()),d=String(i.getMonth()+1),1==d.length&&(d="0"+d),e=String(i.getDate()),1==e.length&&(e="0"+e),f=String(i.getHours()),1==f.length&&(f="0"+f),g=String(i.getMinutes()),1==g.length&&(g="0"+g),h=String(i.getSeconds()),1==h.length&&(h="0"+h),String(b?d+"-"+e+" "+f+":"+g:c+"-"+d+"-"+e+" "+f+":"+g+":"+h)},i=function(a){return isNaN(a)?"00:00":g(parseInt(a/60),2)+":"+g(parseInt(a%60),2)},j=function(a){for(var b=a.split(":"),c=0,d=0;d<b.length;d++){c*=60;var e=parseInt(b[d]);if(isNaN(e)||0>e)return!1;c+=e}return c},k=function(a,e,g){a&&(a.addEventListener("mousemove",function(f){var h=b("ABP-Tooltip"),i=a.clientWidth,j=a.clientHeight,k=a.getBoundingClientRect(),l=d(a,"ABP-Unit").getBoundingClientRect(),m=k.top-l.top,n=e?f.clientX-l.left:k.left-l.left;null==h&&(h=c("div",{id:"ABP-Tooltip"},[c("text",a.tooltipData)]),h.by=a,d(a,"ABP-Unit").appendChild(h),h.style.top=m+j+2+"px",h.style.left=n+i/2-h.clientWidth/2+"px"),e&&(h.style.left=n-h.clientWidth/2+"px"),g&&(h.style.top=m-h.clientHeight+2+g+"px")}),a.addEventListener("mouseout",function(){var a=b("ABP-Tooltip");a&&a.parentNode&&a.parentNode.removeChild(a)}),a.addEventListener("updatetooltip",function(c){var d=b("ABP-Tooltip");d&&d.by==c.target&&(d.innerHTML=f(a.tooltipData))}))},l=function(a,b){if(null!=a){var c=a.className.split(" ");""==c[0]&&(c=[]),c.indexOf(b)<0&&c.push(b),a.className=c.join(" ")}},m=function(a,b){if(null==a)return!1;var c=a.className.split(" ");return""==c[0]&&(c=[]),c.indexOf(b)>=0},n=function(a,b){if(null!=a){var c=a.className.split(" ");""==c[0]&&(c=[]),c.indexOf(b)>=0&&c.splice(c.indexOf(b),1),a.className=c.join(" ")}},o=function(a,b){var c={};for(var d in b)c[d]=a&&"undefined"!=typeof a[d]?a[d]:b[d];return c};ABP.create=function(a,d){var e=a;if(d||(d={}),ABP.playerConfig=d.config?d.config:{},d=o(d,{replaceMode:!0,width:512,height:384,src:""}),"string"==typeof a&&(e=b(a)),m(e,"ABP-Unit"))f=e;else{var f=c("div",{className:"ABP-Unit",style:{width:d.width.toString().indexOf("%")>=0?d.width:d.width+"px",height:d.height.toString().indexOf("%")>=0?d.height:d.height+"px"}});e.appendChild(f)}f.children.length>0&&d.replaceMode&&(f.innerHTML="");var g=[],h=[];if("string"==typeof d.src)d.src=c("video",{autobuffer:"true",dataSetup:"{}"},[c("source",{src:d.src})]),g.push(d.src);else if(d.src.hasOwnProperty("playlist"))for(var i=d.src,j=i.playlist,k=0;k<j.length;k++){if(j[k].hasOwnProperty("sources")){var l=[];for(var n in j[k].sources)l.push(c("source",{src:j[k][n],type:n}));g.push(c("video",{autobuffer:"true",dataSetup:"{}"},l))}else j[k].hasOwnProperty("video")&&g.push(j[k].video);h.push(j[k].comments)}else g.push(d.src);f.appendChild(c("div",{className:"ABP-Player"},[c("div",{className:"ABP-Video",tabindex:"10"},[c("div",{className:"ABP-Container"}),g[0]]),c("div",{className:"ABP-Bottom"},[c("div",{className:"ABP-Text"},[c("div",{className:"ABP-CommentStyle"},[c("div",{className:"button-group ABP-Comment-FontGroup"},[c("div",{className:"button ABP-Comment-Font icon-font-style"}),c("div",{className:"ABP-Comment-FontOption"},[c("p",{className:"style-title"},[c("text","弹幕字号")]),c("div",{className:"style-select",name:"commentFontSize"},[c("div",{className:"style-option",value:18},[c("text","小字号")]),c("div",{className:"style-option on",value:25},[c("text","中字号")])]),c("p",{className:"style-title"},[c("text","弹幕模式")]),c("div",{className:"style-select",name:"commentMode"},[c("div",{className:"style-option",value:5},[c("text","顶端渐隐")]),c("div",{className:"style-option on",value:1},[c("text","滚动字幕")]),c("div",{className:"style-option",value:4},[c("text","底端渐隐")])])])]),c("div",{className:"button-group ABP-Comment-ColorGroup"},[c("div",{className:"ABP-Comment-Color-Display"}),c("div",{className:"button ABP-Comment-Color icon-color-mode"}),c("div",{className:"ABP-Comment-ColorOption"},[c("div",{className:"ABP-Comment-ColorPicker"})])])]),c("input",{className:"ABP-Comment-Input"}),c("div",{className:"ABP-Comment-Send"},[c("text","发送")])]),c("div",{className:"ABP-Control"},[c("div",{className:"button ABP-Play icon-play"}),c("div",{className:"progress-bar"},[c("div",{className:"bar"},[c("div",{className:"load"}),c("div",{className:"dark"})])]),c("div",{className:"time-label"},[c("text","00:00 / 00:00")]),c("div",{className:"button ABP-Volume icon-volume-high"}),c("div",{className:"volume-bar"},[c("div",{className:"bar"},[c("div",{className:"load"})])]),c("div",{className:"button-group ABP-CommentGroup"},[c("div",{className:"button ABP-CommentShow icon-comment on"}),c("div",{className:"ABP-CommentOption"},[c("p",{className:"label"},[c("text","弹幕比例")]),c("div",{className:"scale-bar"},[c("div",{className:"bar"},[c("div",{className:"load"})])]),c("div",{className:"prop-checkbox"}),c("p",{className:"label"},[c("text","弹幕不透明度")]),c("div",{className:"opacity-bar"},[c("div",{className:"bar"},[c("div",{className:"load"})])])])]),c("div",{className:"button ABP-Loop icon-loop"}),c("div",{className:"button ABP-WideScreen icon-tv"}),c("div",{className:"button-group ABP-FullScreenGroup"},[c("div",{className:"button ABP-FullScreen icon-screen-full"}),c("div",{className:"button ABP-Web-FullScreen icon-screen"})])])])])),f.appendChild(c("div",{className:"ABP-Comment-List"},[c("div",{className:"ABP-Comment-List-Title"},[c("div",{className:"cmt-time",item:"time"},[c("text","时间")]),c("div",{className:"cmt-content",item:"content"},[c("text","评论")]),c("div",{className:"cmt-date",item:"date"},[c("text"," 发送日期")])]),c("div",{className:"ABP-Comment-List-Container"},[c("ul",{className:"ABP-Comment-List-Container-Inner"})])]));var p=ABP.bind(f);if(g.length>0){var q=g[0];p.gotoNext=function(){var a=g.indexOf(q)+1;if(a<g.length){q=g[a],q.style.display="";var b=p.video.parentNode;b.removeChild(p.video),b.appendChild(q),p.video.style.display="none",p.video=q,p.swapVideo(q),q.addEventListener("ended",function(){p.gotoNext()})}a<h.length&&null!==h[a]&&CommentLoader(h[a],p.cmManager)},q.addEventListener("ended",function(){p.gotoNext()}),CommentLoader(h[0],p.cmManager)}return p},ABP.bind=function(b,d){var f={playerUnit:b,btnPlay:null,barTime:null,barLoad:null,barTimeHitArea:null,barVolume:null,barVolumeHitArea:null,barOpacity:null,barOpacityHitArea:null,barScale:null,barScaleHitArea:null,btnFont:null,btnColor:null,btnSend:null,controlBar:null,timeLabel:null,timeJump:null,divComment:null,btnWide:null,btnFull:null,btnWebFull:null,btnDm:null,btnLoop:null,btnProp:null,videoDiv:null,btnVolume:null,video:null,txtText:null,commentColor:"ffffff",commentFontSize:25,commentMode:1,displayColor:null,cmManager:null,commentList:null,commentListContainer:null,lastSelectedComment:null,commentCoolDown:1e4,commentScale:ABP.playerConfig.scale?ABP.playerConfig.scale:1,proportionalScale:ABP.playerConfig.prop,defaults:{w:0,h:0},state:o(d,{fullscreen:!1,commentVisible:!0,allowRescale:!1,autosize:!1}),createPopup:function(a,d){if(b.hasPopup===!0)return!1;var e=c("div",{className:"ABP-Popup"},[c("text",a)]);return e.remove=function(){e.isRemoved||(e.isRemoved=!0,b.removeChild(e),b.hasPopup=!1)},b.appendChild(e),b.hasPopup=!0,"number"==typeof d&&setTimeout(function(){e.remove()},d),e},removePopup:function(){for(var a=b.getElementsByClassName("ABP-Popup"),c=0;c<a.length;c++)null!=a[c].remove?a[c].remove():a[c].parentNode.removeChild(a[c]);b.hasPopup=!1},loadCommentList:function(a,b){b="asc"==b?-1:1;var d=Object.keys(f.commentList).sort(function(c,d){return f.commentList[c][a]<f.commentList[d][a]?b:f.commentList[c][a]>f.commentList[d][a]?-b:0});f.commentObjArray=[];for(q in d){var e=d[q],g=f.commentList[e];if(g&&g.time){var j=c("li",{}),l=c("span",{className:"cmt-time"},[c("text",i(g.time/1e3))]),m=c("span",{className:"cmt-content"},[c("text",g.content)]),n=c("span",{className:"cmt-date"},[c("text",h(g.date,!0))]);k(m,!1,36),k(n,!1,18),m.tooltip(g.content),n.tooltip(h(g.date)),j.appendChild(l),j.appendChild(m),j.appendChild(n),j.data=g,j.addEventListener("dblclick",function(){f.video.currentTime=this.data.time/1e3,S(p.currentTime)}),f.commentObjArray.push(j)}}f.commentListContainer.style.height=24*f.commentObjArray.length+"px",f.renderCommentList()},renderCommentList:function(){var a=f.commentListContainer.parentElement.scrollTop,b=parseInt(a/24);f.commentListContainer.innerHTML="";for(var c=b;b+40>=c&&"undefined"!=typeof f.commentObjArray[c];c++){if(c==b&&c>0){var d=f.commentObjArray[c].cloneNode(!0),e=d.getElementsByClassName("cmt-content")[0],g=d.getElementsByClassName("cmt-date")[0];d.addEventListener("dblclick",function(){f.video.currentTime=f.commentObjArray[c].data.time/1e3,S(p.currentTime)}),k(e,!1,36),k(g,!1,18),e.tooltip(f.commentObjArray[c].data.content),g.tooltip(h(f.commentObjArray[c].data.date)),d.style.paddingTop=24*b+"px"}else var d=f.commentObjArray[c];f.commentListContainer.appendChild(d)}f.commentListContainer.parentElement.scrollTop=a},commentCallback:function(a){a.result?(f.commentList[a.id]=f.commentList[a.tmp_id],delete f.commentList[a.tmp_id]):(delete f.commentList[a.tmp_id],f.createPopup(a.error,5e3))},swapVideo:null};if(f.swapVideo=function(a){a.addEventListener("timeupdate",function(){R||S(a.currentTime)}),a.addEventListener("ended",function(){f.btnPlay.className="button ABP-Play icon-play",f.barTime.style.width="0%"}),a.addEventListener("progress",function(){if(null!=this.buffered){try{var a=(this.buffered.start(0),this.buffered.end(0))}catch(b){return}var c=this.duration,d=a/c*100;f.barLoad.style.width=d+"%"}}),a.addEventListener("loadedmetadata",function(){if(null!=this.buffered){try{var a=(this.buffered.start(0),this.buffered.end(0))}catch(b){return}var c=this.duration,d=a/c*100;f.barLoad.style.width=d+"%"}}),a.isBound=!0;var c=0;f.cmManager&&(f.cmManager.addEventListener("load",function(){f.commentList={};for(q in f.cmManager.timeline){var a=f.cmManager.timeline[q];a.dbid&&a.stime&&(f.commentList[a.dbid]={date:a.date,time:a.stime,mode:a.mode,user:a.hash,pool:a.pool,content:a.text})}f.loadCommentList("date","asc"),f.commentListContainer.parentElement.addEventListener("scroll",f.renderCommentList)}),f.cmManager.setBounds=function(){b.offsetHeight<=300||b.offsetWidth<=700?l(b,"ABP-Mini"):n(b,"ABP-Mini");var a=f.videoDiv.offsetWidth,c=f.videoDiv.offsetHeight,d=f.proportionalScale?c/493*f.commentScale:f.commentScale;this.width=a/d,this.height=c/d,this.dispatchEvent("resize");for(var e in this.csa)this.csa[e].setBounds(this.width,this.height);this.stage.style.width=this.width+"px",this.stage.style.height=this.height+"px",this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.zoom=d},f.cmManager.setBounds(),f.cmManager.clear(),a.addEventListener("progress",function(){c==a.currentTime?(a.hasStalled=!0,f.cmManager.stopTimer()):c=a.currentTime}),window&&window.addEventListener("resize",function(){f.cmManager.setBounds()}),a.addEventListener("timeupdate",function(){f.cmManager.display!==!1&&(a.hasStalled&&(f.cmManager.startTimer(),a.hasStalled=!1),f.cmManager.time(Math.floor(1e3*a.currentTime)))}),a.addEventListener("play",function(){f.cmManager.setBounds(),f.cmManager.startTimer();try{var a=this.buffered.end(0),b=this.duration,c=a/b*100;f.barLoad.style.width=c+"%"}catch(d){}}),a.addEventListener("ratechange",function(){null!=f.cmManager.options.globalScale&&0!==a.playbackRate&&(f.cmManager.options.globalScale=1/a.playbackRate,f.cmManager.rescale())}),a.addEventListener("pause",function(){f.cmManager.stopTimer()}),a.addEventListener("waiting",function(){f.cmManager.stopTimer()}),a.addEventListener("playing",function(){f.cmManager.startTimer()}))},null!==b&&null!==b.getElementsByClassName){f.defaults.w=b.offsetWidth,f.defaults.h=b.offsetHeight;var g=b.getElementsByClassName("ABP-Video");if(!(g.length<=0)){var p=null;f.videoDiv=g[0];for(var q in g[0].children)if(null!=g[0].children[q].tagName&&"VIDEO"===g[0].children[q].tagName.toUpperCase()){p=g[0].children[q];break}var r=g[0].getElementsByClassName("ABP-Container");if(r.length>0&&(f.divComment=r[0]),null!==p){f.video=p;var s=b.getElementsByClassName("ABP-Play");if(!(s.length<=0)){f.btnPlay=s[0],f.btnPlay.tooltip("播放"),k(f.btnPlay);var t=b.getElementsByClassName("progress-bar");if(!(t.length<=0)){var u=t[0].getElementsByClassName("bar");f.barTimeHitArea=u[0],f.barLoad=u[0].getElementsByClassName("load")[0],f.barTime=u[0].getElementsByClassName("dark")[0];var v=b.getElementsByClassName("time-label");if(!(v.length<=0)){f.timeLabel=v[0];var w=b.getElementsByClassName("ABP-Volume");if(!(w.length<=0)){f.btnVolume=w[0],f.btnVolume.tooltip("静音"),k(f.btnVolume);var x=b.getElementsByClassName("volume-bar");if(!(x.length<=0)){var y=x[0].getElementsByClassName("bar");f.barVolumeHitArea=y[0],f.barVolume=y[0].getElementsByClassName("load")[0];var z=b.getElementsByClassName("opacity-bar");if(!(z.length<=0)){var z=z[0].getElementsByClassName("bar");f.barOpacityHitArea=z[0],f.barOpacity=z[0].getElementsByClassName("load")[0];var A=b.getElementsByClassName("scale-bar");if(!(A.length<=0)){var A=A[0].getElementsByClassName("bar");f.barScaleHitArea=A[0],f.barScale=A[0].getElementsByClassName("load")[0];var B=b.getElementsByClassName("prop-checkbox");if(!(B.length<=0)){f.btnProp=B[0],f.btnProp.tooltip("缩放同步"),k(f.btnProp);var C=b.getElementsByClassName("ABP-FullScreen");if(!(C.length<=0)){f.btnFull=C[0],f.btnFull.tooltip("浏览器全屏"),k(f.btnFull);var D=b.getElementsByClassName("ABP-Web-FullScreen");if(!(D.length<=0)){f.btnWebFull=D[0],f.btnWebFull.tooltip("网页全屏"),k(f.btnWebFull);var E=b.getElementsByClassName("ABP-WideScreen");if(!(E.length<=0)){f.btnWide=E[0],f.btnWide.tooltip("宽屏模式"),k(f.btnWide);var F=b.getElementsByClassName("ABP-Comment-Font");if(!(F.length<=0)){f.btnFont=F[0],f.btnFont.tooltip("弹幕样式"),k(f.btnFont);var G=b.getElementsByClassName("ABP-Comment-Color");if(!(G.length<=0)){f.btnColor=G[0],f.btnColor.tooltip("弹幕颜色"),k(f.btnColor);var H=b.getElementsByClassName("ABP-Comment-Color-Display");if(!(H.length<=0)){f.displayColor=H[0];var I=b.getElementsByClassName("ABP-Comment-Input");if(!(I.length<=0)){f.txtText=I[0];var J=b.getElementsByClassName("ABP-Comment-List-Container-Inner");if(!(J.length<=0)){f.commentListContainer=J[0];var K=b.getElementsByClassName("ABP-Comment-Send");if(!(K.length<=0)){f.btnSend=K[0],f.btnSend.tooltip("毁灭地喷射白光!da!"),k(f.btnSend);var L=b.getElementsByClassName("ABP-Control");L.length>0&&(f.controlBar=L[0]);var M=b.getElementsByClassName("ABP-CommentShow");if(!(M.length<=0)){f.btnDm=M[0],f.btnDm.tooltip("隐藏弹幕"),k(f.btnDm);var N=b.getElementsByClassName("ABP-Loop");if(!(N.length<=0)){if(f.btnLoop=N[0],f.btnLoop.tooltip("洗脑循环 off"),k(f.btnLoop),"undefined"!=typeof CommentManager&&(f.cmManager=new CommentManager(f.divComment),f.cmManager.display=!0,f.cmManager.init(),f.cmManager.clear(),window&&window.addEventListener("resize",function(){f.cmManager.setBounds()})),"object"==typeof ABP.playerConfig&&(ABP.playerConfig.volume&&(f.video.volume=ABP.playerConfig.volume),ABP.playerConfig.opacity&&(f.cmManager.options.opacity=ABP.playerConfig.opacity)),a(".ABP-Comment-List-Title *").click(function(){var b=a(this).attr("item"),c=a(this).hasClass("asc")?"desc":"asc";a(".ABP-Comment-List-Title *").removeClass("asc").removeClass("desc"),a(this).addClass(c),f.loadCommentList(b,c)}),a(".ABP-Unit .ABP-CommentStyle .ABP-Comment-FontOption .style-option").click(function(){a(this).closest(".style-select").find(".style-option").removeClass("on"),a(this).addClass("on"),f[a(this).closest(".style-select").attr("name")]=parseInt(a(this).attr("value"))}),a(b).find(".ABP-Comment-ColorPicker").colpick({flat:!0,submit:0,color:"ffffff",onChange:function(a,b){f.commentColor=b,f.displayColor.style.backgroundColor="#"+b}}),p.isBound!==!0){f.swapVideo(p),f.videoDiv.addEventListener("click",function(a){f.btnPlay.click(),a.preventDefault()}),f.btnVolume.addEventListener("click",function(){0==f.video.muted?(f.video.muted=!0,this.className="button ABP-Volume icon-volume-mute2",this.tooltip("取消静音"),f.barVolume.style.width="0%"):(f.video.muted=!1,this.className="button ABP-Volume icon-volume-",this.className+=f.video.volume<.1?"mute":f.video.volume<.33?"low":f.video.volume<.67?"medium":"high",this.tooltip("静音"),f.barVolume.style.width=100*f.video.volume+"%")}),f.btnWebFull.addEventListener("click",function(){f.state.fullscreen=m(b,"ABP-FullScreen"),l(b,"ABP-FullScreen"),f.btnFull.className="button ABP-FullScreen icon-screen-normal",f.btnFull.tooltip("退出网页全屏"),f.state.fullscreen=!0,f.cmManager&&f.cmManager.setBounds(),f.state.allowRescale&&(f.state.fullscreen?f.defaults.w>0&&(f.cmManager.options.scrollScale=b.offsetWidth/f.defaults.w):f.cmManager.options.scrollScale=1)}),f.btnFont.addEventListener("click",function(){this.parentNode.classList.toggle("on")}),f.btnColor.addEventListener("click",function(){this.parentNode.classList.toggle("on")}),f.proportionalScale&&f.btnProp.classList.add("on"),f.btnProp.addEventListener("click",function(){this.classList.toggle("on"),f.proportionalScale=this.classList.contains("on"),f.cmManager.setBounds(),P()});var O=function(){!document.isFullScreen()&&m(b,"ABP-FullScreen")&&(n(b,"ABP-FullScreen"),f.btnFull.className="button ABP-FullScreen icon-screen-full",f.btnFull.tooltip("浏览器全屏"))};document.addEventListener("fullscreenchange",O,!1),document.addEventListener("webkitfullscreenchange",O,!1),document.addEventListener("mozfullscreenchange",O,!1),document.addEventListener("MSFullscreenChange",O,!1),f.btnFull.addEventListener("click",function(){f.state.fullscreen=m(b,"ABP-FullScreen"),f.state.fullscreen?(n(b,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-full",this.tooltip("浏览器全屏"),document.exitFullscreen()):(l(b,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-normal",this.tooltip("退出全屏"),b.requestFullScreen()),f.state.fullscreen=!f.state.fullscreen,f.cmManager&&f.cmManager.setBounds(),f.state.allowRescale&&(f.state.fullscreen?f.defaults.w>0&&(f.cmManager.options.scrollScale=b.offsetWidth/f.defaults.w):f.cmManager.options.scrollScale=1)}),f.btnWide.addEventListener("click",function(){f.state.widescreen=m(b,"ABP-WideScreen"),f.state.widescreen?(n(b,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv",b.dispatchEvent(new Event("normal")),this.tooltip("宽屏模式")):(l(b,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv on",b.dispatchEvent(new Event("wide")),this.tooltip("退出宽屏")),f.state.widescreen=!f.state.widescreen,f.cmManager&&f.cmManager.setBounds(),f.state.allowRescale&&(f.state.fullscreen?f.defaults.w>0&&(f.cmManager.options.scrollScale=b.offsetWidth/f.defaults.w):f.cmManager.options.scrollScale=1)}),f.btnDm.addEventListener("click",function(){0==f.cmManager.display?(f.cmManager.display=!0,f.cmManager.startTimer(),this.className="button ABP-CommentShow icon-comment on",this.tooltip("隐藏弹幕")):(f.cmManager.display=!1,f.cmManager.clear(),f.cmManager.stopTimer(),this.className="button ABP-CommentShow icon-comment",this.tooltip("显示弹幕"))}),f.btnLoop.addEventListener("click",function(){0==f.video.loop?(f.video.loop=!0,this.className="button ABP-Loop icon-loop on",this.tooltip("洗脑循环 on")):(f.video.loop=!1,this.className="button ABP-Loop icon-loop",this.tooltip("洗脑循环 off"))});var P=function(){f.playerUnit.dispatchEvent(new CustomEvent("saveconfig",{detail:{volume:f.video.volume,opacity:f.cmManager.options.opacity,scale:f.commentScale,prop:f.proportionalScale}}))},Q=function(){var a=new Date,b=""+a.getTime()+Math.random();return""==f.txtText.value||f.txtText.disabled?!1:(f.playerUnit.dispatchEvent(new CustomEvent("sendcomment",{detail:{id:b,message:f.txtText.value,fontsize:f.commentFontSize,color:parseInt("0x"+f.commentColor),date:a.getFullYear()+"-"+e(a.getMonth())+"-"+e(a.getDay())+" "+e(a.getHours())+":"+e(a.getMinutes())+":"+e(a.getSeconds()),playTime:f.video.currentTime,mode:f.commentMode,pool:0}})),f.cmManager.sendComment({text:f.txtText.value,mode:f.commentMode,stime:f.video.currentTime,size:f.commentFontSize,color:parseInt("0x"+f.commentColor),border:!0}),f.commentList[b]={date:parseInt(a.getTime()/1e3),time:1e3*f.video.currentTime,mode:f.commentMode,user:"-",pool:0,content:f.txtText.value},f.txtText.value="",f.txtText.disabled=!0,void setTimeout(function(){f.txtText.disabled=!1},f.commentCoolDown))};f.txtText.addEventListener("keyup",function(a){13==a.keyCode&&Q()}),f.btnSend.addEventListener("click",Q),f.timeLabel.addEventListener("click",function(){f.timeJump=c("input",{className:"time-jump"}),f.timeJump.value=i(f.video.currentTime),f.controlBar.appendChild(f.timeJump),f.timeJump.addEventListener("blur",function(){f.timeJump&&f.timeJump.parentNode.removeChild(f.timeJump),f.timeJump=null}),f.timeJump.addEventListener("keydown",function(a){if(13==a.keyCode){var b=j(f.timeJump.value);b&&b<=f.video.duration&&(f.video.currentTime=b,f.video.paused&&f.btnPlay.click()),f.timeJump.parentNode.removeChild(f.timeJump)}else(a.keyCode<48||a.keyCode>58)&&8!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode&&46!=a.keyCode&&a.preventDefault()}),f.timeJump.focus(),f.timeJump.select()}),f.barTime.style.width="0%";var R=!1;f.barTimeHitArea.addEventListener("mousedown",function(){R=!0}),document.addEventListener("mouseup",function(a){if(R){var b=(a.clientX-f.barTimeHitArea.getBoundingClientRect().left)/f.barTimeHitArea.offsetWidth*f.video.duration;0>b&&(b=0),Math.abs(b-f.video.currentTime)>4&&f.cmManager&&f.cmManager.clear(),f.video.currentTime=b}R=!1});var S=function(a){f.barTime.style.width=a/p.duration*100+"%",f.timeLabel.innerHTML=i(a)+" / "+i(p.duration)};document.addEventListener("mousemove",function(a){var b=(a.clientX-f.barTimeHitArea.getBoundingClientRect().left)/f.barTimeHitArea.offsetWidth*f.video.duration;0>b&&(b=0),b>f.video.duration&&(b=f.video.duration),f.barTimeHitArea.tooltip(i(b)),R&&S(b)}),k(f.barTimeHitArea,!0,-12);var T=!1;f.barVolumeHitArea.addEventListener("mousedown",function(){T=!0}),f.barVolume.style.width=100*f.video.volume+"%";var U=function(a){f.barVolume.style.width=100*a+"%",f.video.muted=!1,f.btnVolume.className="button ABP-Volume icon-volume-",f.btnVolume.className+=.1>a?"mute":.33>a?"low":.67>a?"medium":"high",f.btnVolume.tooltip("静音"),f.barVolumeHitArea.tooltip(parseInt(100*a)+"%"),P()};document.addEventListener("mouseup",function(a){if(T){var b=(a.clientX-f.barVolumeHitArea.getBoundingClientRect().left)/f.barVolumeHitArea.offsetWidth;0>b&&(b=0),b>1&&(b=1),f.video.volume=b,U(f.video.volume)}T=!1}),document.addEventListener("mousemove",function(a){var b=(a.clientX-f.barVolumeHitArea.getBoundingClientRect().left)/f.barVolumeHitArea.offsetWidth;0>b&&(b=0),b>1&&(b=1),T?(f.video.volume=b,U(f.video.volume)):f.barVolumeHitArea.tooltip(parseInt(100*b)+"%")}),k(f.barVolumeHitArea,!0,-12);var V=!1;f.barOpacityHitArea.addEventListener("mousedown",function(){V=!0}),f.barOpacity.style.width=100*f.cmManager.options.opacity+"%";var W=function(a){f.barOpacity.style.width=100*a+"%",f.barOpacityHitArea.tooltip(parseInt(100*a)+"%"),P()};document.addEventListener("mouseup",function(a){if(V){var b=(a.clientX-f.barOpacityHitArea.getBoundingClientRect().left)/f.barOpacityHitArea.offsetWidth;0>b&&(b=0),b>1&&(b=1),f.cmManager.options.opacity=b,W(f.cmManager.options.opacity)}V=!1}),document.addEventListener("mousemove",function(a){var b=(a.clientX-f.barOpacityHitArea.getBoundingClientRect().left)/f.barOpacityHitArea.offsetWidth;0>b&&(b=0),b>1&&(b=1),V?(f.cmManager.options.opacity=b,W(f.cmManager.options.opacity)):f.barOpacityHitArea.tooltip(parseInt(100*b)+"%")}),k(f.barOpacityHitArea,!0,-6);var X=!1;f.barScaleHitArea.addEventListener("mousedown",function(){X=!0}),f.barScale.style.width=(f.commentScale-.2)/4.8*100+"%";var Y=function(a){f.barScale.style.width=(a-.2)/4.8*100+"%",f.barScaleHitArea.tooltip(parseInt(100*a)+"%"),f.cmManager.setBounds(),P()};document.addEventListener("mouseup",function(a){if(X){var b=.2+4.8*(a.clientX-f.barScaleHitArea.getBoundingClientRect().left)/f.barScaleHitArea.offsetWidth;.2>b&&(b=.2),b>5&&(b=5),f.commentScale=b,Y(f.commentScale)}X=!1}),document.addEventListener("mousemove",function(a){var b=.2+4.8*(a.clientX-f.barScaleHitArea.getBoundingClientRect().left)/f.barScaleHitArea.offsetWidth;.2>b&&(b=.2),b>5&&(b=5),X?(f.commentScale=b,Y(f.commentScale)):f.barScaleHitArea.tooltip(parseInt(100*b)+"%")}),k(f.barScaleHitArea,!0,-6),f.btnPlay.addEventListener("click",function(){f.video.paused?(f.video.play(),this.className="button ABP-Play ABP-Pause icon-pause",this.tooltip("暂停")):(f.video.pause(),this.className="button ABP-Play icon-play",this.tooltip("播放"))}),b.addEventListener("keydown",function(a){if(a&&"INPUT"!=document.activeElement.tagName)switch(a.preventDefault(),a.keyCode){case 32:f.btnPlay.click();break;case 37:var b=f.video.currentTime-=5;f.cmManager.clear(),0>b&&(b=0),f.video.currentTime=b.toFixed(3),f.video.paused&&f.btnPlay.click(),S(p.currentTime),f.barTimeHitArea.tooltip(i(p.currentTime));break;case 39:var b=f.video.currentTime+=5;f.cmManager.clear(),b>f.video.duration&&(b=f.video.duration),f.video.currentTime=b.toFixed(3),f.video.paused&&f.btnPlay.click(),S(p.currentTime),f.barTimeHitArea.tooltip(i(p.currentTime));break;case 38:var c=f.video.volume+.1;c>1&&(c=1),f.video.volume=c.toFixed(3),U(f.video.volume);break;case 40:var c=f.video.volume-.1;0>c&&(c=0),f.video.volume=c.toFixed(3),U(f.video.volume)}}),b.addEventListener("touchmove",function(){event.preventDefault()});var Z=null;b.addEventListener("touchstart",function(a){a.targetTouches.length>0&&(Z=a.targetTouches[0])}),b.addEventListener("touchend",function(a){if(a.changedTouches.length>0&&null!=Z){var b=a.changedTouches[0].pageX-Z.pageX,c=a.changedTouches[0].pageY-Z.pageY;if(Math.abs(b)<20&&Math.abs(c)<20)return void(Z=null);Math.abs(b)>3*Math.abs(c)?b>0?f.video.paused&&f.btnPlay.click():f.video.paused||f.btnPlay.click():Math.abs(c)>3*Math.abs(b)&&(f.video.volume=0>c?Math.min(1,f.video.volume+.1):Math.max(0,f.video.volume-.1)),Z=null}}),b.addEventListener("mouseup",function(){if("INPUT"!=document.activeElement.tagName){var a=window.scrollY;f.videoDiv.focus(),window.scrollTo(window.scrollX,a)}})}if("undefined"!=typeof CommentManager&&f.state.autosize){var $=function(){if(0!==p.videoHeight&&0!==p.videoWidth){var a=p.videoHeight/p.videoWidth,c=b.offsetWidth,d=b.offsetHeight,e=d/c;a>e?(b.style.width=d/a+"px",b.style.height=d+"px"):(b.style.width=c+"px",b.style.height=c*a+"px"),f.cmManager.setBounds()}};p.addEventListener("loadedmetadata",$),$()}return f}}}}}}}}}}}}}}}}}}}}}}}}}();